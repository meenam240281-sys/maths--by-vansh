<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Graphing Tool</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background: #f9f9f9;
    }
    nav {
      background: #0077cc;
      padding: 12px;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
    }
    nav a {
      color: white;
      text-decoration: none;
      margin: 5px 15px;
      font-weight: bold;
    }
    nav a:hover {
      text-decoration: underline;
    }
    .container {
      padding: 20px;
      text-align: center;
    }
    input, button {
      padding: 8px;
      margin: 5px;
      font-size: 16px;
    }
    #graph {
      width: 100%;
      height: 80vh;
    }
  </style>
</head>
<body>
  <!-- Navigation -->
  <nav>
    <a href="index.html">Home</a>
    <a href="mathsolver.html">Math Solver</a>
    <a href="graph.html">Graphs</a>
    <a href="resources.html">Resources</a>
    <a href="contact.html">Contact</a>
  </nav>

  <!-- Graph Section -->
  <div class="container">
    <h2>Interactive Graphing Tool</h2>
    <p>Enter equation (e.g., <b>x+y=3</b>) or points (e.g., <b>2,3; 3,4; 5,2</b>)</p>
    <input type="text" id="input" placeholder="Equation or points">
    <label>
      <input type="checkbox" id="connectPoints"> Connect Points
    </label>
    <button onclick="plotInput()">Plot</button>
    <div id="graph"></div>
  </div>

  <script>
    // 25 distinct bright colors
    const colors = [
      "#FF5733","#33FF57","#3357FF","#FF33A8","#FF8C33",
      "#33FFF5","#8D33FF","#FFD433","#33FF99","#FF3333",
      "#33A1FF","#A833FF","#FF33D4","#33FFD4","#FFB833",
      "#66FF33","#FF6633","#3399FF","#9933FF","#FF3399",
      "#33FFCC","#FF33CC","#99FF33","#33CCFF","#CC33FF"
    ];

    let traces = [];
    let colorIndex = 0;
    let groupActive = false; // track connectPoints mode per group
    let lastTraceIndex = null;

    function plotInput() {
      const input = document.getElementById("input").value.trim();
      const connect = document.getElementById("connectPoints").checked;

      if (!input) return;

      // Check if it's an equation or points
      if (input.includes("=")) {
        plotEquation(input);
      } else {
        plotPoints(input, connect);
      }

      document.getElementById("input").value = "";
    }

    function plotEquation(equation) {
      let color = colors[colorIndex % colors.length];
      colorIndex++;

      // Parse equation like x+y=3
      try {
        let [lhs, rhs] = equation.split("=");
        rhs = rhs.trim();
        lhs = lhs.replace(/\s+/g, "");
        let xValues = [], yValues = [];

        for (let x = -10; x <= 10; x += 0.2) {
          let expr = lhs.replace(/x/g, `(${x})`);
          // solve for y
          let y = eval(rhs + " - (" + expr.replace(/y/g, "0") + ")");
          if (!isNaN(y) && isFinite(y)) {
            xValues.push(x);
            yValues.push(y);
          }
        }

        traces.push({
          x: xValues,
          y: yValues,
          mode: "lines",
          line: {color: color, width: 2},
          name: equation
        });
        Plotly.newPlot("graph", traces, layout);
      } catch (e) {
        alert("Invalid equation format. Try like: x+y=3");
      }
    }

    function plotPoints(input, connect) {
      const groups = input.split(";").map(pt => pt.trim());
      let xs = [], ys = [];

      groups.forEach(pt => {
        let [x, y] = pt.split(",").map(Number);
        if (!isNaN(x) && !isNaN(y)) {
          xs.push(x);
          ys.push(y);
        }
      });

      if (xs.length === 0) return;

      if (connect) {
        // Continue same color group
        if (groupActive && lastTraceIndex !== null) {
          traces[lastTraceIndex].x.push(...xs);
          traces[lastTraceIndex].y.push(...ys);
        } else {
          let color = colors[colorIndex % colors.length];
          traces.push({
            x: xs,
            y: ys,
            mode: "markers+lines",
            marker: {color: color, size: 8},
            line: {color: color, width: 2},
            name: "Connected Group " + (colorIndex + 1)
          });
          lastTraceIndex = traces.length - 1;
          colorIndex++;
          groupActive = true;
        }
      } else {
        // New group with new color
        let color = colors[colorIndex % colors.length];
        traces.push({
          x: xs,
          y: ys,
          mode: "markers",
          marker: {color: color, size: 8},
          name: "Points " + (colorIndex + 1)
        });
        colorIndex++;
        groupActive = false;
        lastTraceIndex = null;
      }

      Plotly.newPlot("graph", traces, layout);
    }

    const layout = {
      plot_bgcolor: "#fff",
      paper_bgcolor: "#fff",
      xaxis: {
        zeroline: true,
        title: "X Axis",
        showgrid: true,
        gridcolor: "#ddd",
        tickfont: {color: "#333"}
      },
      yaxis: {
        zeroline: true,
        title: "Y Axis",
        showgrid: true,
        gridcolor: "#ddd",
        tickfont: {color: "#333"}
      },
      dragmode: "pan"
    };

    Plotly.newPlot("graph", traces, layout);
  </script>
</body>
</html>
