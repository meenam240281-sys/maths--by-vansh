<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Maths Solver</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #f4f4f9;
      color: #333;
    }
    header {
      background: #2d3e50;
      color: #fff;
      padding: 1rem;
      text-align: center;
    }
    .solver-container {
      max-width: 900px;
      margin: 2rem auto;
      background: #fff;
      padding: 2rem;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    .solver-container h2 {
      margin-top: 0;
      text-align: center;
    }
    #expression {
      width: 100%;
      font-size: 1.2rem;
      padding: 0.5rem;
      margin: 1rem 0;
      border: 1px solid #ccc;
      border-radius: 8px;
    }
    .buttons {
      display: flex;
      gap: 1rem;
      justify-content: center;
      margin-bottom: 1.5rem;
    }
    button {
      padding: 0.6rem 1.2rem;
      font-size: 1rem;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    .solve-btn { background: #4caf50; color: white; }
    .clear-btn { background: #f44336; color: white; }
    .clearall-btn { background: #9c27b0; color: white; }
    #result {
      background: #f9f9f9;
      border: 1px solid #ddd;
      padding: 1rem;
      border-radius: 8px;
      min-height: 50px;
      white-space: pre-wrap;
    }
    iframe {
      width: 100%;
      height: 400px;
      border: none;
      margin-top: 1rem;
    }
    .note {
      margin-top: 2rem;
      background: #fff3cd;
      color: #856404;
      padding: 1rem;
      border-radius: 8px;
      border: 1px solid #ffeeba;
      font-size: 0.95rem;
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.8.0/math.min.js"></script>
</head>
<body>
  <header>
    <h1>Maths Solver</h1>
  </header>  <div class="solver-container">
    <h2>Solve your expression</h2>
    <input type="text" id="expression" placeholder="Enter equation or expression"><div class="buttons">
  <button class="solve-btn" onclick="solveExpression()">Solve</button>
  <button class="clear-btn" onclick="clearLast()">Clear</button>
  <button class="clearall-btn" onclick="clearAll()">Clear All</button>
</div>

<div id="result">Result will appear here...</div>

<!-- Embed the keyboard -->
<iframe src="keyboard.html"></iframe>

<!-- Notes / Cautions -->
<div class="note">
  <strong>Notes:</strong>
  <ul>
    <li>Please use brackets where needed (e.g. (2/3)x vs 2/(3x)).</li>
    <li>Roots like √4 or ∛8 don’t need brackets.</li>
    <li>Default: log = base 10, ln = natural log.</li>
    <li>Equations in multiple variables are supported (e.g. x+y=5).</li>
    <li>Results may be shown in fraction and decimal both.</li>
    <li>Complex numbers may appear as <em>a+bi</em> or in polar form.</li>
  </ul>
</div>

  </div>  <script>
    // Append keyboard clicks
    window.addEventListener("message", function(event) {
      if (event.data.type === "keyPress") {
        const exprInput = document.getElementById("expression");
        const cursorPos = exprInput.selectionStart;
        const text = exprInput.value;
        const before = text.substring(0, cursorPos);
        const after = text.substring(cursorPos);
        exprInput.value = before + event.data.value + after;
        exprInput.focus();
        exprInput.selectionStart = exprInput.selectionEnd = cursorPos + event.data.value.length;
      }
    });

    function preprocess(expr) {
      // Handle roots without brackets
      expr = expr.replace(/√(\d+(?:\.\d+)?)/g, 'sqrt($1)');
      expr = expr.replace(/∛(\d+(?:\.\d+)?)/g, 'cbrt($1)');
      // Implicit multiplication: 2x -> 2*x
      expr = expr.replace(/(\d)([a-zA-Z])/g, '$1*$2');
      expr = expr.replace(/([a-zA-Z])(\d)/g, '$1*$2');
      return expr;
    }

    function solveExpression() {
      const exprInput = document.getElementById("expression");
      const resultDiv = document.getElementById("result");
      let expr = exprInput.value.trim();
      if (!expr) {
        resultDiv.textContent = "Please enter an input.";
        return;
      }

      try {
        expr = preprocess(expr);

        if (expr.includes('=')) {
          // Solve equations
          let [lhs, rhs] = expr.split('=').map(side => math.simplify(side));
          const equation = math.subtract(lhs, rhs);
          const solutions = math.solve(equation, Object.keys(lhs.filter ? lhs.filter(() => true) : {x:1}));
          resultDiv.textContent = "Solutions: " + JSON.stringify(solutions, null, 2);
        } else {
          // Evaluate
          let simplified = math.simplify(expr);
          let evaluated = math.evaluate(expr);
          resultDiv.textContent = simplified.toString() + " = " + evaluated;
        }
      } catch (err) {
        resultDiv.textContent = "Invalid input. Please check your expression.";
      }
    }

    function clearLast() {
      const exprInput = document.getElementById("expression");
      exprInput.value = exprInput.value.slice(0, -1);
    }

    function clearAll() {
      document.getElementById("expression").value = "";
      document.getElementById("result").textContent = "Result will appear here...";
    }
  </script></body>
</html>
