<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>MathsSolver</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background: #f4f6f9;
    }
    h1 {
      text-align: center;
      color: #2c3e50;
    }
    #solver-container {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      background: white;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    input, button, textarea {
      font-size: 16px;
      padding: 10px;
      margin: 8px 0;
      border-radius: 6px;
      border: 1px solid #ccc;
      width: 100%;
    }
    button {
      background: #2ecc71;
      color: white;
      cursor: pointer;
      border: none;
    }
    button:hover {
      background: #27ae60;
    }
    #output {
      margin-top: 20px;
      padding: 15px;
      background: #ecf0f1;
      border-radius: 6px;
      min-height: 50px;
      white-space: pre-wrap;
    }
    .note {
      font-size: 14px;
      color: #555;
      margin-top: 10px;
      background: #fdf6e3;
      padding: 10px;
      border-left: 4px solid #f39c12;
      border-radius: 4px;
    }
  </style>
  <!-- Load Math.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.11.0/math.js"></script>
</head>
<body>
  <div id="solver-container">
    <h1>üìò MathsSolver</h1>
    <p>Enter your equation, expression, or problem:</p>
    <textarea id="user-input" rows="3" placeholder="Example: 2x + 5 = 11"></textarea>
    <button onclick="solveMath()">Solve</button>
    <div id="output"></div>
    <div class="note">
      ‚ö†Ô∏è Notes & Cautions:<br>
      - Use brackets () when possible to avoid ambiguity.<br>
      - Example: type (2/3)*x instead of 2/3x.<br>
      - Supports algebra, equations, calculus, trigonometry, factorials, matrices, and more.<br>
      - Works best for school-level maths (Class 6‚Äì12).<br>
      - For graphs, visit the Graph section (coming soon).<br>
    </div>
  </div>

  <script>
    // Preprocess user input to fix common mistakes
    function preprocessInput(input) {
      let expr = input;

      // Replace ^ with ** for power
      expr = expr.replace(/\^/g, "**");

      // Insert * between number and variable (e.g., 2x -> 2*x)
      expr = expr.replace(/(\d)([a-zA-Z])/g, "$1*$2");

      // Insert * between variable and variable (e.g., xy -> x*y)
      expr = expr.replace(/([a-zA-Z])([a-zA-Z])/g, "$1*$2");

      // Fix cases like 2/3x -> (2/3)*x
      expr = expr.replace(/(\d+)\/(\d+)([a-zA-Z])/g, "($1/$2)*$3");

      return expr.trim();
    }try {
        // If input contains '=' => treat as equation
        if (processed.includes("=")) {
          let sides = processed.split("=");
          if (sides.length !== 2) throw new Error("Equation not valid.");

          let lhs = math.parse(sides[0]);
          let rhs = math.parse(sides[1]);

          // Variables auto-detection
          let variables = Object.keys(lhs.filter(node => node.isSymbolNode)
            .reduce((acc, node) => (acc[node.name] = true, acc), {}));
          rhs.filter(node => node.isSymbolNode)
            .forEach(node => variables.push(node.name));
          variables = [...new Set(variables)].filter(v => !["e","i"].includes(v));

          if (variables.length === 0) {
            // Solve numeric equality
            const evalLHS = math.evaluate(sides[0]);
            const evalRHS = math.evaluate(sides[1]);
            resultText = (evalLHS === evalRHS) ? "‚úÖ True equation" : "‚ùå False equation";
          } 
          else if (variables.length === 1) {
            // Solve single variable equation
            let variable = variables[0];
            try {
              let sol = math.solve(processed, variable);
              if (Array.isArray(sol)) {
                resultText = "üîé Solutions for " + variable + ": " + sol.join(", ");
              } else {
                resultText = "üîé Solution for " + variable + ": " + sol;
              }
            } catch(err) {
              resultText = "‚ö†Ô∏è Could not solve equation automatically. Try rearranging.";
            }
          }
          else {
            // Multiple variables ‚Üí system of equations not yet complete
            resultText = "‚ö†Ô∏è Multiple variables detected (" + variables.join(", ") + ").\n";
            resultText += "Currently solves linear/quadratic single-variable equations directly.\n";
            resultText += "For multiple variables, system solver will be expanded.";
          }
        }
        else {
          // Expression (not an equation)
          let value = math.evaluate(processed);

          // Try fraction and decimal
          let frac = math.fraction(value);
          let approx = math.format(value, {precision: 14});
          
          resultText = "üìä Simplified Result:\n";
          if (frac) {
            resultText += "- Fraction: " + frac.n + "/" + frac.d + "\n";
          }
          resultText += "- Decimal: " + approx + "\n";

          // Factorial check
          if (/!/.test(processed)) {
            resultText += "‚ö° Factorial detected and computed.\n";
          }

          // Trigonometric auto-conversion
          if (/sin|cos|tan|cot|sec|csc/.test(processed)) {
            resultText += "üåÄ Trigonometric evaluation done (in radians).\n";
          }

          // Logarithm
          if (/log|ln/.test(processed)) {
            resultText += "üìñ Logarithm detected and evaluated.\n";
          }
        }
      } catch (err) {
        resultText = "‚ùå Invalid input or unsupported feature.\n" + err.message;
      }

      document.getElementById("output").innerText = resultText;
    }
  </script>

    function solveMath() {
      const input = document.getElementById("user-input").value.trim();
      if (!input) {
        document.getElementById("output").innerText = "‚ùå Please enter something to solve.";
        return;
      }

      const processed = preprocessInput(input);
      let resultText = "";
<script>
    // Extra helper: auto nth-root expansion
    function nthRoot(base, n) {
      return math.pow(base, 1/n);
    }

    // Handle advanced solve
    function advancedSolve(input) {
      let resultText = "";

      try {
        // Quadratic equations
        if (/x\^2/.test(input)) {
          let coeffs = math.quadraticSolver(input, "x");
          resultText += "üî¢ Quadratic Equation Solutions:\n";
          resultText += coeffs.join(", ") + "\n";
        }

        // Cubic equations
        else if (/x\^3/.test(input)) {
          try {
            let roots = math.solve(input, "x");
            resultText += "üî¢ Cubic Equation Solutions:\n";
            resultText += roots.join(", ") + "\n";
          } catch(err) {
            resultText += "‚ö†Ô∏è Could not solve cubic automatically.\n";
          }
        }

        // Inequalities
        else if (/[<>‚â§‚â•]/.test(input)) {
          resultText += "‚öñÔ∏è Inequality Detected.\n";
          resultText += "Currently evaluates numeric check or needs graphing.\n";
        }

        // Nth roots
        else if (/‚àö/.test(input) || /nthroot/.test(input)) {
          resultText += "üü¢ Nth Root Function.\n";
          resultText += "Tip: 'nthroot(a, n)' means n-th root of a.\n";
        }

        // Complex numbers
        else if (/i/.test(input)) {
          let comp = math.evaluate(input);
          resultText += "üåÄ Complex Number:\n";
          resultText += "- Rectangular: " + comp.toString() + "\n";
          resultText += "- Polar: " + math.complex(comp).toPolar().r.toFixed(3)
                        + " ‚à† " + math.complex(comp).toPolar().phi.toFixed(3) + "\n";
        }

        // Calculus basics
        else if (/d\//.test(input) || /derivative/.test(input)) {
          let expr = input.replace("derivative", "");
          let deriv = math.derivative(expr, "x").toString();
          resultText += "üìà Derivative: " + deriv + "\n";
        }
        else if (/integrate/.test(input)) {
          let expr = input.replace("integrate", "");
          resultText += "üìâ Integration currently symbolic support limited.\n";
          try {
            let integ = math.integral(expr, "x").toString();
            resultText += "Integration: " + integ + "\n";
          } catch {
            resultText += "‚ö†Ô∏è Integration needs external CAS.\n";
          }
        }

        // Default ‚Üí fallback
        else {
          let val = math.evaluate(input);
          resultText = "Result: " + val;
        }
      } catch(err) {
        resultText = "‚ùå Error in advanced solver: " + err.message;
      }

      document.getElementById("output").innerText = resultText;
    }
  </script>

  <footer>
    <p>üìù Notes:</p>
    <ul>
      <li>Use brackets when possible for clarity.</li>
      <li>All trig functions are in radians.</li>
      <li>Supports: algebra, trig, logs, factorials, roots, calculus (basic), complex numbers.</li>
      <li>For graphs of equations ‚Üí Visit <a href="graphs.html">Graphs Page</a>.</li>
    </ul>
  </footer>
</body>
</html>
